# geo-fias-mdlp-matcher

## Описание

SQL-скрипт для сопоставления кодов ФИАС из системы МДЛП и «Сенсус клиентов» с использованием данных Федеральной информационной адресной системы (ФИАС/ГАР).
Цель — нормализовать адресные данные, выявить расхождения и сформировать корректные соответствия на уровне дома, улицы и населённого пункта между источниками.

---

## Цели проекта

- Объединение данных из разных источников (МДЛП, Сенсус, ФИАС)
- Сопоставление кодов ФИАС из разных систем
- Определение случаев:
  - когда адрес не найден,
  - когда адрес найден, но различается между источниками,
  - когда код ФИАС однозначно идентифицирует точку.

---

## Используемые таблицы

| Источник | Таблицы |
|---------|---------|
| **FIAS** | `AS_REESTR_OBJECTS`, `AS_MUN_HIERARCHY`, `AS_ADDR_OBJ`, `AS_HOUSES`, `AS_HOUSE_TYPES` |
| **SSA**  | `hs_MDLP_reestr_partners`, `Сенсус клиентов`, `Apt` |

---

## Этапы обработки

1. **Получение базовой иерархии из FIAS**
   - Составляется таблица `#BaseQuery` с OBJECTID и PATH.
2. **Разбиение PATH и детализация объектов**
   - Разворачиваются уровни адреса (субъект, район, город, улица и т.п.).
3. **Определение уровня дома (LEVEL 10)**
   - Привязка к конкретному дому через `AS_HOUSES`.
4. **Сопоставление с МДЛП и Сенсус**
   - Соединение по `OBJECTGUID`, `branch_address_fias_houseguid`, `Код ФИАС`.
5. **Анализ совпадений**
   - Формируются группы:
     - `#Final_1_code_Fias`: однозначные совпадения
     - `#MDLP_isnull`: не определено со стороны МДЛП
     - `#Final_code_Fias`: многократные, но одинаковые гео-результаты
